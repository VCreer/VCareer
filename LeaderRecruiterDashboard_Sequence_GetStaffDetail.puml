@startuml
title Get Staff Performance Detail - Sequence Diagram

autonumber 1

actor "Leader Recruiter" as Leader
participant "RecruitmentDashboardController" as API
participant "RecruitmentDashboardAppService" as Service
participant "RecruiterRepository" as RecruiterRepo
participant "ActivityLogRepository" as ActivityRepo
database "Database" as DB

Leader -> API : GET /staff/{staffId}/performance
activate API
note over Leader, API
Request:
- StaffId (from URL)
- StartDate
- EndDate
end note

API -> Service : GetStaffPerformanceAsync(staffId, filter)
activate Service

autonumber 1.1
Service -> RecruiterRepo : GetCurrentRecruiterProfileAsync()
activate RecruiterRepo

autonumber 1.1.1
RecruiterRepo -> DB : ExecuteQuery()
activate DB
return Return result

autonumber 1.1.2
return Return currentRecruiterProfile

autonumber 1.2
Service -> Service : Validate IsLead()

alt Not a Leader
    autonumber 1.2.1
    return Return error message
    autonumber 1.2.2
    return Return 403 Forbidden
else Is Leader
    autonumber 1.3
    Service -> RecruiterRepo : FindAsync(staffId)
    activate RecruiterRepo
    
    autonumber 1.3.1
    RecruiterRepo -> DB : ExecuteQuery()
    activate DB
    return Return result
    
    autonumber 1.3.2
    return Return staffProfile
    
    autonumber 1.4
    Service -> Service : Validate same company
    
    alt Different Company
        autonumber 1.4.1
        return Return error message
        autonumber 1.4.2
        return Return 403 Forbidden
    else Same Company
        autonumber 1.5
        Service -> ActivityRepo : Get staff activities
        activate ActivityRepo
        
        autonumber 1.5.1
        ActivityRepo -> DB : ExecuteQuery()
        activate DB
        return Return result
        
        autonumber 1.5.2
        return Return activityLogs
        
        autonumber 1.6
        Service -> Service : Calculate performance metrics
        note right of Service
        Calculate:
        - Job statistics
        - Candidate statistics
        - Interview statistics
        - Approval rate
        - Interview completion rate
        - Activities per day
        end note
        
        autonumber 1.7
        Service -> Service : Build StaffPerformanceDto
        
        autonumber 1.8
        return Return staff performance
        
        autonumber 1.9
        return Return 200 OK + JSON
    end
end

@enduml





