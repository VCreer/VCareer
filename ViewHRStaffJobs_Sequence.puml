@startuml
title View HR Staff Job List - Sequence Diagram

autonumber 1

actor "Team Leader" as Leader
participant "TeamManagementController" as API
participant "TeamManagementAppService" as Service
participant "RecruiterRepository" as RecruiterRepo
participant "JobRepository" as JobRepo
participant "UserManager" as UserMgr
database "Database" as DB

Leader -> API : GET /api/team-management/members/{staffId}/jobs
activate API
note over Leader, API
Query Parameters:
- MaxResultCount
- SkipCount
- Sorting
end note

API -> Service : GetHrStaffJobsAsync(staffId, input)
activate Service

autonumber 1.1
Service -> RecruiterRepo : GetCurrentUserProfileAsync()
activate RecruiterRepo

autonumber 1.1.1
RecruiterRepo -> DB : ExecuteQuery()
activate DB
return Return result

autonumber 1.1.2
return Return currentUserProfile

autonumber 1.2
Service -> Service : Validate current user is Recruiter

alt Not a Recruiter
    autonumber 1.2.1
    return Return error message
    autonumber 1.2.2
    return Return error message
else Is Recruiter
    autonumber 1.3
    Service -> RecruiterRepo : FindAsync(staffId)
    activate RecruiterRepo
    
    autonumber 1.3.1
    RecruiterRepo -> DB : ExecuteQuery()
    activate DB
    return Return result
    
    autonumber 1.3.2
    return Return staffMember
    
    autonumber 1.4
    Service -> Service : Validate same company
    
    alt Different Company
        autonumber 1.4.1
        return Return error message
        autonumber 1.4.2
        return Return error message
    else Same Company
        autonumber 1.5
        Service -> JobRepo : GetListAsync(j => j.RecruiterId == staffId)
        activate JobRepo
        
        autonumber 1.5.1
        JobRepo -> DB : ExecuteQuery()
        activate DB
        return Return jobs
        
        autonumber 1.5.2
        return Return jobs list
        
        autonumber 1.6
        Service -> Service : Map to HrStaffJobDto list
        
        autonumber 1.7
        Service -> Service : Apply sorting
        
        autonumber 1.8
        Service -> Service : Apply paging\n(Skip & Take)
        
        autonumber 1.9
        Service -> Service : Calculate statistics\n(Total, Active, Draft, Closed)
        
        autonumber 1.10
        Service -> UserMgr : GetByIdAsync(staffMember.UserId)
        activate UserMgr
        
        autonumber 1.10.1
        UserMgr -> DB : ExecuteQuery()
        activate DB
        return Return user
        
        autonumber 1.10.2
        return Return staffUser
        
        autonumber 1.11
        Service -> Service : Build HrStaffJobListDto
        
        autonumber 1.12
        return Return HrStaffJobListDto
        
        autonumber 1.13
        return Return job list response
    end
end

@enduml

