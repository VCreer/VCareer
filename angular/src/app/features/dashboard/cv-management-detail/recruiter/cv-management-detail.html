<div class="cv-detail-container" [class.sidebar-expanded]="sidebarExpanded">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Đang tải CV...</p>
  </div>

  <!-- White Card Wrapper - Contains header and content -->
  <div *ngIf="!loading" class="cv-detail-card" [class.html-cv-mode]="cvType === 'online'">
    <!-- Recruitment Header - Only campaign info and close button -->
    <div class="recruitment-header">
      <!-- Left: Campaign Information -->
      <div class="header-left">
        <div class="campaign-header-info">
          <i class="fa fa-flag campaign-icon"></i>
          <div class="campaign-text">
            <span class="campaign-label">Chiến dịch tuyển dụng</span>
            <span class="campaign-name">{{ application?.jobTitle || 'Tuyển dụng Developer tháng 10' }}</span>
          </div>
        </div>
      </div>

      <!-- Right: Close Button -->
      <button class="close-btn" (click)="onClose()" aria-label="Close">
        <i class="fa fa-times"></i>
      </button>
    </div>

    <!-- CV Detail Content -->
    <div class="cv-detail-content" [class.html-cv-content]="cvType === 'online'">
      <!-- Left Column: CV Content -->
      <div *ngIf="cvDetail" class="cv-content-column">
        <!-- PDF Viewer for Uploaded CV -->
        <div *ngIf="cvType === 'uploaded' && pdfUrl" class="cv-viewer-container">
          <iframe 
            [src]="pdfUrl" 
            class="cv-iframe"
            frameborder="0"
            allowfullscreen>
          </iframe>
        </div>

        <!-- HTML Viewer for Online CV -->
        <div *ngIf="cvType === 'online' && safeCvHtml" class="cv-viewer-container">
          <div class="cv-html-content" [innerHTML]="safeCvHtml"></div>
        </div>

        <!-- No CV Message -->
        <div *ngIf="!pdfUrl && !safeCvHtml && !loading" class="no-cv-message">
          <i class="fa fa-file-pdf-o"></i>
          <p>Không thể hiển thị CV</p>
        </div>
      </div>

      <!-- Right Column: Recruitment Info - Always visible -->
      <div class="recruitment-info-column">
      
      <!-- Applicant Summary Card -->
      <div class="applicant-summary-card" *ngIf="cvDetail">
        <div class="candidate-header-summary">
          <div class="candidate-avatar-summary">
            <span>{{ getInitials(cvDetail.name) }}</span>
          </div>
          <div class="candidate-info-summary">
            <div class="candidate-name-summary">{{ cvDetail.name }}</div>
            <div class="view-status-badge" [class.viewed]="isViewed" [class.not-viewed]="!isViewed">
              {{ isViewed ? 'Đã xem' : 'Chưa xem' }}
            </div>
            <div class="contact-opened-summary" *ngIf="cvDetail.contactOpenedDate">
              Đã mở liên hệ ngày {{ cvDetail.contactOpenedDate }}
            </div>
          </div>
        </div>
        <div class="contact-details-summary">
          <div class="contact-detail-summary-item">
            <span class="contact-value-summary">{{ cvDetail.email }}</span>
          </div>
          <div class="contact-detail-summary-item">
            <span class="contact-value-summary">{{ cvDetail.phone }}</span>
          </div>
        </div>
        <div class="contact-actions-summary">
          <button class="contact-btn-summary phone-btn" (click)="onContact('phone')" title="Gọi điện">
            <i class="fa fa-phone"></i>
          </button>
          <button class="contact-btn-summary email-btn" (click)="onContact('email')" title="Gửi email">
            <i class="fa fa-envelope"></i>
          </button>
          <button class="contact-btn-summary chat-btn" (click)="onContact('chat')" title="Nhắn tin">
            <i class="fa fa-comments"></i>
          </button>
        </div>
      </div>

      <!-- Recruitment Campaign -->
      <div class="campaign-info-card" *ngIf="cvDetail">
        <div class="campaign-header-small">
          <i class="fa fa-flag campaign-icon-small"></i>
          <span class="campaign-label-small">Chiến dịch tuyển dụng</span>
        </div>
        <div class="campaign-name-small">{{ application?.jobTitle || cvDetail?.campaignName }}</div>
      </div>

      <!-- CV Status -->
      <div class="status-card">
        <p class="status-description">
          Thực hiện đánh giá sẽ giúp hệ thống tối ưu tốt hơn cho chiến dịch tuyển dụng của bạn.
        </p>
        <div class="status-dropdown-wrapper">
          <div class="status-dropdown" [class.disabled]="!cvDetail || changingStatus" [class.open]="showStatusDropdown" (click)="toggleStatusDropdown()">
            <span class="status-dropdown-text">{{ getStatusLabel(selectedStatus) }}</span>
            <i class="fa fa-chevron-down status-dropdown-icon" [class.rotated]="showStatusDropdown"></i>
            <i *ngIf="changingStatus" class="fa fa-spinner fa-spin status-loading-icon"></i>
          </div>
          <div class="status-dropdown-menu" *ngIf="showStatusDropdown" (click)="$event.stopPropagation()">
            <div 
              class="status-dropdown-item" 
              *ngFor="let status of statusOptions"
              [class.active]="selectedStatus === status.value"
              (click)="onStatusSelect(status.value)">
              <span class="status-item-label">{{ status.label }}</span>
              <i class="fa fa-check status-item-check" *ngIf="selectedStatus === status.value"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <app-button
          type="secondary"
          size="medium"
          (click)="onDownloadPdf()"
          [disabled]="!cvDetail">
          Tải CV PDF
        </app-button>
      </div>
    </div>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<app-toast-notification
  [show]="showToast"
  [message]="toastMessage"
  [type]="toastType"
  (close)="onToastClose()">
</app-toast-notification>

