<div
  class="company-verify-page"
  [style.margin-left]="getPageMarginLeft()"
  [style.width]="getPageWidth()"
>
  <div
    class="breadcrumb-box"
    [style.left]="getBreadcrumbLeft()"
    [style.width]="getBreadcrumbWidth()"
  >
    <div class="breadcrumb-container">
      <h1 class="page-title">Xác thực công ty</h1>
    </div>
  </div>

  <div class="company-verify-content" [style.max-width]="getContentMaxWidth()">
    <!-- Tab Selector -->
    <div class="tab-selector">
      <button
        type="button"
        class="tab-btn"
        [class.active]="activeTab === 'pending'"
        (click)="onTabChange('pending')"
      >
        <i class="fa fa-clock"></i>
        <span>Chờ xác thực</span>
      </button>
      <button
        type="button"
        class="tab-btn"
        [class.active]="activeTab === 'verified'"
        (click)="onTabChange('verified')"
      >
        <i class="fa fa-check-circle"></i>
        <span>Đã xác minh</span>
      </button>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
      <div class="search-input-wrapper">
        <i class="fa fa-search search-icon"></i>
        <input
          type="text"
          class="search-input"
          [(ngModel)]="searchKeyword"
          [placeholder]="activeTab === 'pending' ? 'Tìm kiếm theo tên công ty, mã số thuế, email...' : 'Tìm kiếm công ty đã xác minh...'"
          (keyup.enter)="onSearch()"
        />
        <button type="button" class="search-btn" (click)="onSearch()">
          Tìm kiếm
        </button>
      </div>
    </div>

    <!-- Company List Card -->
    <div class="company-list-card">
      <div class="wrapper-content" [class.show-detail-company]="selectedCompany">
        <div class="company-list-column">
          <!-- Loading State -->
          <div class="loading-state" *ngIf="isLoading">
            <div class="loading-spinner">
              <i class="fa fa-spinner fa-spin"></i>
            </div>
            <p class="loading-text">Đang tải dữ liệu...</p>
          </div>

          <!-- Company List -->
          <div class="company-list" *ngIf="!isLoading && filteredCompanies.length > 0; else emptyState">
            <div
              class="company-item"
              *ngFor="let company of filteredCompanies"
              [class.selected]="selectedCompany?.id === company.id"
              (click)="onCompanyClick(company)"
            >
              <div class="company-item-left">
                <div class="company-icon">
                  <i class="fa fa-building"></i>
                </div>
              </div>

              <div class="company-item-center">
                <div class="company-header-top">
                  <div class="company-code">Mã: #{{ company.companyCode || company.id }}</div>
                  <div class="company-date">
                    <i class="fa fa-calendar"></i>
                    <span>{{ formatDate(company.creationTime) }}</span>
                  </div>
                </div>
                <div class="company-header">
                  <h3 class="company-name">{{ company.companyName }}</h3>
                </div>

                <div class="company-info-wrapper">
                  <div class="company-info">
                    <div class="info-item" *ngIf="company.contactEmail">
                      <i class="fa fa-envelope"></i>
                      <span>{{ company.contactEmail }}</span>
                    </div>
                    <div class="info-item" *ngIf="company.contactPhone">
                      <i class="fa fa-phone"></i>
                      <span>{{ company.contactPhone }}</span>
                    </div>
                    <div class="info-item" *ngIf="company.taxCode">
                      <i class="fa fa-file-invoice"></i>
                      <span>MST: {{ company.taxCode }}</span>
                    </div>
                  </div>
                </div>

                <div class="company-footer">
                  <div class="recruiter-info" *ngIf="company.recruiterName">
                    <i class="fa fa-user"></i>
                    <span>{{ company.recruiterName }}</span>
                  </div>
                  <div class="status-badge" [ngClass]="activeTab === 'pending' ? 'pending' : 'verified'">
                    <i [class]="activeTab === 'pending' ? 'fa fa-clock' : 'fa fa-check-circle'"></i>
                    <span>{{ activeTab === 'pending' ? 'Chờ xác thực' : 'Đã xác minh' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #emptyState>
            <div class="empty-list" *ngIf="!isLoading">
              <i class="fa fa-building"></i>
              <p>{{ activeTab === 'pending' ? 'Không có công ty nào chờ xác thực.' : 'Không có công ty nào đã được xác minh.' }}</p>
            </div>
          </ng-template>

          <app-pagination
            *ngIf="!isLoading && totalPages > 1"
            [currentPage]="currentPage"
            [totalPages]="totalPages"
            [totalItems]="totalItems"
            [itemsPerPage]="itemsPerPage"
            (pageChange)="onPageChange($event)"
          >
          </app-pagination>
        </div>

        <!-- Company Detail View -->
        <div class="box-view-company-detail" *ngIf="selectedCompany">
          <div class="company-detail-header">
            <div class="company-code-header">Mã công ty: #{{ selectedCompany.companyCode || selectedCompany.id }}</div>
            <h2 class="company-detail-title">{{ selectedCompany.companyName }}</h2>
            <button type="button" class="close-detail-btn" (click)="onCloseDetail()">
              <i class="fa fa-times"></i>
            </button>
          </div>

          <div class="company-detail-content">
            <!-- Basic Information -->
            <div class="detail-section">
              <h3 class="section-title">Thông tin cơ bản</h3>
              <ul class="section-list">
                <li *ngIf="selectedCompany.contactEmail">
                  <strong>Email:</strong> {{ selectedCompany.contactEmail }}
                </li>
                <li *ngIf="selectedCompany.contactPhone">
                  <strong>Điện thoại:</strong> {{ selectedCompany.contactPhone }}
                </li>
                <li *ngIf="selectedCompany.headquartersAddress">
                  <strong>Địa chỉ:</strong> {{ selectedCompany.headquartersAddress }}
                </li>
                <li *ngIf="selectedCompany.websiteUrl">
                  <strong>Website:</strong> 
                  <a [href]="selectedCompany.websiteUrl" target="_blank">{{ selectedCompany.websiteUrl }}</a>
                </li>
                <li *ngIf="selectedCompany.companySize">
                  <strong>Quy mô:</strong> {{ selectedCompany.companySize }} nhân viên
                </li>
                <li *ngIf="selectedCompany.foundedYear">
                  <strong>Năm thành lập:</strong> {{ selectedCompany.foundedYear }}
                </li>
                <li *ngIf="selectedCompany.description">
                  <strong>Mô tả:</strong> {{ selectedCompany.description }}
                </li>
              </ul>
            </div>

            <!-- Legal Information -->
            <div class="detail-section">
              <h3 class="section-title">Thông tin pháp lý</h3>
              <ul class="section-list">
                <li *ngIf="selectedCompany.taxCode">
                  <strong>Mã số thuế:</strong> {{ selectedCompany.taxCode }}
                </li>
                <li *ngIf="selectedCompany.businessLicenseNumber">
                  <strong>Số giấy phép kinh doanh:</strong> {{ selectedCompany.businessLicenseNumber }}
                </li>
                <li *ngIf="selectedCompany.businessLicenseIssueDate">
                  <strong>Ngày cấp:</strong> {{ formatDate(selectedCompany.businessLicenseIssueDate) }}
                </li>
                <li *ngIf="selectedCompany.businessLicenseIssuePlace">
                  <strong>Nơi cấp:</strong> {{ selectedCompany.businessLicenseIssuePlace }}
                </li>
                <li *ngIf="selectedCompany.legalRepresentative">
                  <strong>Người đại diện pháp luật:</strong> {{ selectedCompany.legalRepresentative }}
                </li>
              </ul>
            </div>

            <!-- Documents -->
            <div class="detail-section" *ngIf="selectedCompany.businessLicenseFile || selectedCompany.taxCertificateFile || selectedCompany.representativeIdCardFile || selectedCompany.otherSupportFile">
              <h3 class="section-title">Tài liệu đính kèm</h3>
              <div class="document-links">
                <a *ngIf="selectedCompany.businessLicenseFile" [href]="selectedCompany.businessLicenseFile" target="_blank" class="document-link">
                  <i class="fa fa-file-pdf"></i>
                  Giấy phép kinh doanh
                </a>
                <a *ngIf="selectedCompany.taxCertificateFile" [href]="selectedCompany.taxCertificateFile" target="_blank" class="document-link">
                  <i class="fa fa-file-pdf"></i>
                  Giấy chứng nhận mã số thuế
                </a>
                <a *ngIf="selectedCompany.representativeIdCardFile" [href]="selectedCompany.representativeIdCardFile" target="_blank" class="document-link">
                  <i class="fa fa-file-pdf"></i>
                  CCCD người đại diện
                </a>
                <a *ngIf="selectedCompany.otherSupportFile" [href]="selectedCompany.otherSupportFile" target="_blank" class="document-link">
                  <i class="fa fa-file-pdf"></i>
                  Tài liệu hỗ trợ khác
                </a>
              </div>
            </div>

            <!-- Recruiter Information -->
            <div class="detail-section" *ngIf="selectedCompany.recruiterName">
              <h3 class="section-title">Thông tin người đăng ký</h3>
              <ul class="section-list">
                <li>
                  <strong>Tên:</strong> {{ selectedCompany.recruiterName }}
                </li>
                <li *ngIf="selectedCompany.recruiterEmail">
                  <strong>Email:</strong> {{ selectedCompany.recruiterEmail }}
                </li>
              </ul>
            </div>

            <!-- Verification Info (for verified companies) -->
            <div class="detail-section" *ngIf="activeTab === 'verified' && selectedCompany.legalReviewedAt">
              <h3 class="section-title">Thông tin xác minh</h3>
              <ul class="section-list">
                <li *ngIf="selectedCompany.legalReviewedAt">
                  <strong>Ngày xác minh:</strong> {{ formatDate(selectedCompany.legalReviewedAt) }}
                </li>
                <li *ngIf="selectedCompany.legalReviewedBy">
                  <strong>Người xác minh:</strong> ID: {{ selectedCompany.legalReviewedBy }}
                </li>
              </ul>
            </div>

            <!-- Action Buttons (only show for pending companies) -->
            <div class="detail-actions" *ngIf="activeTab === 'pending'">
              <button type="button" class="action-btn approve-btn" (click)="onApprove()" [disabled]="isLoading">
                <i class="fa fa-check"></i>
                Duyệt
              </button>
              <button type="button" class="action-btn reject-btn" (click)="onReject()" [disabled]="isLoading">
                <i class="fa fa-times"></i>
                Từ chối
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Reject Modal -->
<div
  class="reject-modal-overlay"
  *ngIf="showRejectModal"
  (click)="onCloseRejectModal()"
  [style.padding-left]="getModalPaddingLeft()"
>
  <div
    class="reject-modal-content"
    (click)="$event.stopPropagation()"
    [style.max-width]="getModalMaxWidth()"
  >
    <div class="reject-modal-header">
      <h3 class="reject-modal-title">Từ chối công ty</h3>
      <button type="button" class="close-modal-btn" (click)="onCloseRejectModal()">
        <i class="fa fa-times"></i>
      </button>
    </div>
    <div class="reject-modal-body">
      <div class="form-group">
        <label class="form-label">Lý do từ chối <span class="required">*</span></label>
        <textarea
          class="form-textarea"
          [(ngModel)]="rejectNotes"
          placeholder="Nhập lý do từ chối công ty này. Lý do này sẽ được gửi cho Recruiter..."
          rows="5"
        ></textarea>
      </div>
    </div>
    <div class="reject-modal-footer">
      <button type="button" class="btn btn-cancel" (click)="onCloseRejectModal()">
        Hủy
      </button>
      <button type="button" class="btn btn-submit" (click)="onSubmitReject()" [disabled]="isLoading || !rejectNotes.trim()">
        <i class="fa fa-check" *ngIf="!isLoading"></i>
        <i class="fa fa-spinner fa-spin" *ngIf="isLoading"></i>
        Xác nhận từ chối
      </button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<app-toast-notification
  *ngIf="showToast"
  [message]="toastMessage"
  [type]="toastType"
  (close)="onToastClose()"
></app-toast-notification>

