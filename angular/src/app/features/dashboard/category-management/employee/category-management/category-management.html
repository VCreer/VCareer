<div class="category-management-page" [style.margin-left]="getPageMarginLeft()" [style.width]="getPageWidth()">
  <!-- Toast Notification -->
  <app-toast-notification
    [show]="showToast"
    [message]="toastMessage"
    [type]="toastType"
    (close)="onCloseToast()">
  </app-toast-notification>

  <!-- Breadcrumb Box -->
  <div class="breadcrumb-box" [style.left]="getBreadcrumbLeft()" [style.width]="getBreadcrumbWidth()">
    <div class="breadcrumb-container">
      <div class="breadcrumb-left">
        <span class="breadcrumb-item active">Quản lí danh mục</span>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="header-actions">
      <app-button
        type="primary"
        size="medium"
        (click)="onCreateCategory()">
        <i class="fa fa-plus"></i>
        Tạo danh mục
      </app-button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" [style.max-width]="getContentMaxWidth()">
    <!-- Card Container -->
    <div class="content-card">
      <!-- Search and Filter Bar -->
      <div class="search-filter-container">
        <!-- Search Bar -->
        <div class="search-bar">
          <div class="search-input-wrapper">
            <i class="fa fa-search search-icon"></i>
            <input
              type="text"
              class="search-input"
              placeholder="Tìm theo tên danh mục, mô tả..."
              [(ngModel)]="searchKeyword"
              (ngModelChange)="applyFilters()">
          </div>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar">
          <div class="filter-group">
            <app-select-field
              placeholder="Tất cả trạng thái"
              [options]="statusOptions"
              [(ngModel)]="filterStatus"
              (ngModelChange)="applyFilters()">
            </app-select-field>
          </div>
        </div>
      </div>

      <!-- Categories Table -->
      <div class="table-container">
        <table class="users-table">
          <thead>
            <tr>
              <th (click)="onSort('name')" class="sortable">
                Tên danh mục
                <i class="fa fa-sort" *ngIf="sortField !== 'name'"></i>
                <i class="fa fa-sort-up" *ngIf="sortField === 'name' && sortDirection === 'asc'"></i>
                <i class="fa fa-sort-down" *ngIf="sortField === 'name' && sortDirection === 'desc'"></i>
              </th>
              <th>Danh mục con</th>
              <th>Trạng thái</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let category of paginatedCategories">
              <td class="name-cell">{{ category.name }}</td>
              <td class="sub-category-names">
                <div class="name-list" *ngIf="getSubCategoryNames(category.id).length > 0">
                  <span class="name-item" *ngFor="let name of getSubCategoryNames(category.id)">{{ name }}</span>
                </div>
                <span class="no-data" *ngIf="getSubCategoryNames(category.id).length === 0">-</span>
              </td>
              <td>
                <span class="status-badge" [ngClass]="category.isActive ? 'status-active' : 'status-inactive'">
                  {{ category.isActive ? 'Đang hoạt động' : 'Ngừng hoạt động' }}
                </span>
              </td>
              <td class="actions-cell">
                <div class="actions-menu-container">
                  <button
                    type="button"
                    class="actions-menu-btn"
                    (click)="toggleActionsMenu(category.id, $event)">
                    <i class="fa fa-ellipsis-v"></i>
                  </button>
                  <div
                    class="actions-menu"
                    *ngIf="showActionsMenu === category.id"
                    [style.top.px]="menuPosition?.top"
                    [style.left.px]="menuPosition?.left"
                    [style.max-width.px]="menuPosition?.maxWidth">
                    <div class="menu-item" (click)="onEditCategory(category)">
                      <i class="fa fa-edit menu-icon"></i>
                      <span>Sửa</span>
                    </div>
                    <div class="menu-item" (click)="onManageSubCategories(category)">
                      <i class="fa fa-folder-open menu-icon"></i>
                      <span>Quản lý danh mục con</span>
                    </div>
                    <div class="menu-item" (click)="onToggleActive(category)">
                      <i class="fa menu-icon" [ngClass]="category.isActive ? 'fa-toggle-on' : 'fa-toggle-off'"></i>
                      <span>{{ category.isActive ? 'Tắt' : 'Bật' }}</span>
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item" (click)="onDeleteCategory(category)">
                      <i class="fa fa-trash menu-icon"></i>
                      <span>Xóa</span>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
            <tr *ngIf="paginatedCategories.length === 0">
              <td colspan="4" class="empty-state">
                <i class="fa fa-inbox"></i>
                <p>Không có dữ liệu</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <app-pagination
        *ngIf="totalPages > 1"
        [currentPage]="currentPage"
        [totalPages]="totalPages"
        (pageChange)="onPageChange($event)">
      </app-pagination>
    </div>
  </div>
</div>

<!-- Create Category Modal -->
<app-generic-modal
  [show]="showCreateModal"
  title="Tạo danh mục mới"
  [maxWidth]="'600px'"
  [bodyBackground]="'white'"
  (close)="showCreateModal = false; isCreating = false">
  <div class="modal-content-wrapper">
    <div class="form-group">
      <app-input-field
        label="Tên danh mục"
        placeholder="Nhập tên danh mục"
        [required]="true"
        [(ngModel)]="createForm.name">
      </app-input-field>
    </div>
    <div class="modal-actions">
      <app-button
        type="secondary"
        size="medium"
        (click)="showCreateModal = false; isCreating = false">
        Hủy
      </app-button>
      <app-button
        type="primary"
        size="medium"
        (click)="onConfirmCreate($event)"
        [disabled]="isCreating">
        Tạo
      </app-button>
    </div>
  </div>
</app-generic-modal>

<!-- Edit Category Modal -->
<app-generic-modal
  [show]="showEditModal"
  title="Sửa danh mục"
  [maxWidth]="'600px'"
  [bodyBackground]="'white'"
  (close)="showEditModal = false">
  <div class="modal-content-wrapper">
    <div class="form-group">
      <app-input-field
        label="Tên danh mục"
        placeholder="Nhập tên danh mục"
        [required]="true"
        [(ngModel)]="editForm.name">
      </app-input-field>
    </div>
    <div class="modal-actions">
      <app-button
        type="secondary"
        size="medium"
        (click)="showEditModal = false">
        Hủy
      </app-button>
      <app-button
        type="primary"
        size="medium"
        (click)="onConfirmEdit()">
        Lưu
      </app-button>
    </div>
  </div>
</app-generic-modal>

<!-- Delete Category Modal -->
<app-generic-modal
  [show]="showDeleteModal"
  title="Xóa danh mục"
  [maxWidth]="'500px'"
  [bodyBackground]="'white'"
  (close)="showDeleteModal = false">
  <div class="modal-content-wrapper">
    <p class="modal-message">
      Bạn có chắc chắn muốn xóa danh mục <strong>{{ selectedCategory?.name }}</strong>?
      Hành động này không thể hoàn tác.
    </p>
    <div class="modal-actions">
      <app-button
        type="secondary"
        size="medium"
        (click)="showDeleteModal = false">
        Hủy
      </app-button>
      <app-button
        type="primary"
        size="medium"
        (click)="onConfirmDelete()">
        Xóa
      </app-button>
    </div>
  </div>
</app-generic-modal>

