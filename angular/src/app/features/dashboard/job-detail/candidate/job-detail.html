<div class="job-detail-page">
  <!-- Search Header -->
  <app-search-header
    [pageTitle]="translate('job_detail.title')"
    [showPageTitle]="false"
    [selectedCategory]="selectedCategory"
    [selectedLocation]="selectedLocation"
    [searchPosition]="searchPosition"
    [categoryPlaceholder]="translate('job_page.category_placeholder')"
    [positionPlaceholder]="translate('job_page.position_placeholder')"
    [locationPlaceholder]="translate('job_page.location_placeholder')"
    [searchButton]="translate('job_page.search_button')"
    [categories]="{
      it: translate('job_page.categories.it'),
      marketing: translate('job_page.categories.marketing'),
      accounting: translate('job_page.categories.accounting')
    }"
    [locationLongAn]="translate('job_data.location_long_an')"
    [locationHanoi]="translate('job_page.locations.hanoi')"
    [locationHcm]="translate('job_page.locations.hcm')"
    [locationDanang]="translate('job_page.locations.danang')"
    (categoryChange)="onCategoryChange($event)"
    (locationChange)="onLocationChange($event)"
    (positionChange)="onPositionChange($event)"
    (search)="onSearch()"
    (clearPosition)="onClearPosition()">
  </app-search-header>

  <!-- Breadcrumb -->
  <div class="breadcrumb-wrapper">
    <div class="breadcrumb-container">
      <a routerLink="/candidate" class="breadcrumb-item">{{ translate('breadcrumb.home') }}</a>
      <span class="breadcrumb-separator">></span>
      <a routerLink="/candidate/job" class="breadcrumb-item">{{ translate('breadcrumb.jobs') }}</a>
      <span class="breadcrumb-separator">></span>
      <span class="breadcrumb-item active">{{ jobDetail?.title || translate('job_detail.title') }}</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoadingJob" class="loading-container">
    <div class="loading-spinner"></div>
    <p>{{ translate('common.loading') }}...</p>
  </div>

  <!-- Job Detail Content -->
  <div *ngIf="!isLoadingJob && jobDetail" class="job-detail-container">
    <!-- Left Column -->
    <div class="job-detail__box--left">
      <!-- Job Info Section -->
      <div class="job-detail__info">
        <!-- Job Title -->
        <div class="job-detail__info--title">
          <h1>{{ jobDetail.title }}</h1>
          <div class="job-meta" *ngIf="jobDetail.postedAt">
            <span class="posted-time">
              <i class="fa fa-clock"></i>
              {{ getTimeAgo() }}
            </span>
            <span class="view-count" *ngIf="jobDetail.viewCount">
              <i class="fa fa-eye"></i>
              {{ jobDetail.viewCount }} {{ translate('job_detail.views') }}
            </span>
            <span class="apply-count" *ngIf="jobDetail.applyCount">
              <i class="fa fa-paper-plane"></i>
              {{ jobDetail.applyCount }} {{ translate('job_detail.applications') }}
            </span>
          </div>
        </div>

        <!-- Job Details Section -->
        <div class="job-detail__info--sections">
          <div class="job-detail__info-item">
            <div class="job-detail__info-item-icon">
              <i class="fa fa-dollar-sign"></i>
            </div>
            <div class="job-detail__info-item-content">
              <div class="job-detail__info-item-title">{{ translate('job_detail.salary') }}</div>
              <div class="job-detail__info-item-value">{{ getSalaryDisplay() }}</div>
            </div>
          </div>
          <div class="job-detail__info-item">
            <div class="job-detail__info-item-icon">
              <i class="fa fa-map-marker-alt"></i>
            </div>
            <div class="job-detail__info-item-content">
              <div class="job-detail__info-item-title">{{ translate('job_detail.location') }}</div>
              <div class="job-detail__info-item-value">{{ getLocationDisplay() }}</div>
            </div>
          </div>
          <div class="job-detail__info-item">
            <div class="job-detail__info-item-icon">
              <i class="fa fa-briefcase"></i>
            </div>
            <div class="job-detail__info-item-content">
              <div class="job-detail__info-item-title">{{ translate('job_detail.experience') }}</div>
              <div class="job-detail__info-item-value">{{ getExperienceText() }}</div>
            </div>
          </div>
        </div>

        <!-- Deadline -->
        <div class="job-deadline">
          <i class="fa fa-clock"></i>
          <span>{{ translate('job_detail.deadline') }}: {{ getDeadlineText() }}</span>
        </div>

        <!-- Action Buttons -->
        <div class="job-detail__info--actions">
          <button class="box-apply-current" (click)="openApplyModal()">
            <i class="fa fa-paper-plane"></i>
            {{ translate('job_detail.apply_now') }}
          </button>
          <button class="box-apply-save" [class.active]="isHeartActive" (click)="toggleHeart()">
            <i class="fa fa-heart"></i>
          </button>
        </div>
      </div>

      <!-- Toast Notification -->
      <app-toast-notification 
        [show]="showToast" 
        [message]="toastMessage" 
        type="success"
        (close)="onToastClose()">
      </app-toast-notification>

      <!-- Job Description Section -->
      <div class="job-detail__box--left-content">
        <!-- Recruitment Details Header -->
        <div class="recruitment-details-header">
          <div class="section-title-bar"></div>
          <h2 class="section-title">{{ translate('job_detail.recruitment_details') }}</h2>
        </div>

        <!-- Job Description -->
        <div class="job-detail__info--section" *ngIf="jobDetail.description">
          <h3 class="section-title">{{ translate('job_detail.job_description') }}</h3>
          <div [innerHTML]="jobDetail.description"></div>
        </div>

        <!-- Candidate Requirements -->
        <div class="job-detail__info--section" *ngIf="jobDetail.requirements">
          <h3 class="section-title">{{ translate('job_detail.candidate_requirements') }}</h3>
          <div [innerHTML]="jobDetail.requirements"></div>
        </div>

        <!-- Benefits Section -->
        <div class="job-detail__info--section" *ngIf="jobDetail.benefits">
          <h3 class="section-title">{{ translate('job_detail.benefits') }}</h3>
          <div [innerHTML]="jobDetail.benefits"></div>
        </div>

        <!-- Work Location & Time Section -->
        <div class="job-detail__info--section">
          <h3 class="section-title">{{ translate('job_detail.work_info') }}</h3>
          <div class="work-info-grid">
            <div class="work-info-item" *ngIf="jobDetail.workLocation">
              <strong>{{ translate('job_detail.work_location') }}:</strong>
              <p>{{ jobDetail.workLocation }}</p>
            </div>
            <div class="work-info-item" *ngIf="jobDetail.workTime">
              <strong>{{ translate('job_detail.work_time') }}:</strong>
              <p>{{ jobDetail.workTime }}</p>
            </div>
            <div class="work-info-item" *ngIf="jobDetail.quantity">
              <strong>{{ translate('job_detail.quantity') }}:</strong>
              <p>{{ jobDetail.quantity }} {{ translate('job_detail.people') }}</p>
            </div>
          </div>
        </div>

        <!-- Application Method Section -->
        <div class="job-detail__info--section">
          <h3 class="section-title">{{ translate('job_detail.application_method') }}</h3>
          <p>{{ translate('job_detail.apply_online_description') }}</p>
          
          <div class="job-deadline" style="margin-top: 1rem;">
            <span>{{ translate('job_detail.deadline') }}: {{ getDeadlineText() }}</span>
          </div>

          <div class="job-detail__info--actions" style="margin-top: 1rem;">
            <button class="box-apply-current" (click)="openApplyModal()">
              <i class="fa fa-paper-plane"></i>
              {{ translate('job_detail.apply_now') }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="job-detail__box--right">
      <!-- Company Info -->
      <div class="job-detail__company">
        <div class="company-logo">
          <div class="logo-box" *ngIf="jobDetail.companyImageUrl">
            <img [src]="jobDetail.companyImageUrl" [alt]="jobDetail.companyName" />
          </div>
          <div class="logo-box logo-placeholder" *ngIf="!jobDetail.companyImageUrl">
            {{ jobDetail.companyName?.substring(0, 2).toUpperCase() }}
          </div>
        </div>
        <h3 class="company-name">{{ jobDetail.companyName }}</h3>
        <a (click)="viewCompanyDetail()" class="company-link" style="cursor: pointer;">
          {{ translate('job_detail.view_company_page') }}
          <i class="fa fa-external-link-alt"></i>
        </a>
      </div>

      <!-- General Information -->
      <div class="job-detail__body-right--item job-detail__body-right--box-general">
        <h3>{{ translate('job_detail.general_info') }}</h3>
        
        <div class="info-item">
          <i class="fa fa-user"></i>
          <span class="label">{{ translate('job_detail.job_level') }}:</span>
          <span>{{ getPositionTypeText() }}</span>
        </div>
        
        <div class="info-item">
          <i class="fa fa-briefcase"></i>
          <span class="label">{{ translate('job_detail.work_type') }}:</span>
          <span>{{ getEmploymentTypeText() }}</span>
        </div>
        
        <div class="info-item">
          <i class="fa fa-graduation-cap"></i>
          <span class="label">{{ translate('job_detail.experience') }}:</span>
          <span>{{ getExperienceText() }}</span>
        </div>
        
        <div class="info-item" *ngIf="jobDetail.quantity">
          <i class="fa fa-users"></i>
          <span class="label">{{ translate('job_detail.quantity') }}:</span>
          <span>{{ jobDetail.quantity }} {{ translate('job_detail.people') }}</span>
        </div>

        <div class="info-item" *ngIf="jobDetail.postedAt">
          <i class="fa fa-calendar"></i>
          <span class="label">{{ translate('job_detail.posted_date') }}:</span>
          <span>{{ getPostedDate() }}</span>
        </div>
      </div>

      <!-- Category and Location Box -->
      <div class="job-detail__body-right--item job-detail__body-right--box-category">
        <h3>{{ translate('job_detail.related_categories') }}</h3>
        <div class="category-tags">
          <span class="tag" *ngIf="categoryName">{{ categoryName }}</span>
          <span class="tag" *ngIf="!categoryName">{{ translate('job_detail.not_specified') }}</span>
        </div>

        <h3 style="margin-top: 1.5rem;">{{ translate('job_detail.area') }}</h3>
        <div class="category-tags">
          <span class="tag" *ngIf="wardName">{{ wardName }}</span>
          <span class="tag" *ngIf="provinceName">{{ provinceName }}</span>
          <span class="tag" *ngIf="!provinceName && !wardName">{{ translate('job_detail.not_specified') }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoadingJob && !jobDetail" class="error-container">
    <i class="fa fa-exclamation-circle"></i>
    <h2>{{ translate('job_detail.not_found') }}</h2>
    <p>{{ translate('job_detail.not_found_message') }}</p>
    <button class="btn-primary" routerLink="/candidate/job">
      {{ translate('job_detail.back_to_jobs') }}
    </button>
  </div>

  <!-- Apply Modal -->
  <app-apply-job-modal
    [show]="showApplyModal"
    [title]="translate('job_detail.apply_now') + ' - ' + (jobDetail?.title || '')"
    (close)="closeApplyModal()"
    (submit)="onModalSubmit($event)">
  </app-apply-job-modal>
</div>