<div class="my-services-page" [class.sidebar-expanded]="sidebarExpanded">
  <!-- Toast Notification -->
  <app-toast-notification
    [show]="showToast"
    [message]="toastMessage"
    [type]="toastType"
    (close)="onToastClose()">
  </app-toast-notification>

  <!-- Breadcrumb Box -->
  <div class="breadcrumb-box" [class.sidebar-expanded]="sidebarExpanded">
    <div class="breadcrumb-container">
      <h1 class="page-title">Dịch vụ của tôi</h1>
    </div>
  </div>

  <div class="my-services-container">
    <!-- Left Sidebar -->
    <div class="services-sidebar">
      <nav class="sidebar-nav">
        <ul class="sidebar-nav-list">
          <li class="sidebar-nav-item" [class.active]="activeTab === 'running'">
            <a (click)="onTabChange('running')" class="sidebar-link">
              <i [ngClass]="getTabIcon('running')"></i>
              <span>{{ getTabLabel('running') }}</span>
            </a>
          </li>
          <li class="sidebar-nav-item" [class.active]="activeTab === 'ended'">
            <a (click)="onTabChange('ended')" class="sidebar-link">
              <i [ngClass]="getTabIcon('ended')"></i>
              <span>{{ getTabLabel('ended') }}</span>
            </a>
          </li>
          <li class="sidebar-nav-item" [class.active]="activeTab === 'expired'">
            <a (click)="onTabChange('expired')" class="sidebar-link">
              <i [ngClass]="getTabIcon('expired')"></i>
              <span>{{ getTabLabel('expired') }}</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Content Wrapper -->
    <div class="main-content-wrapper">
      <!-- Header -->
      <div class="content-header">
        <h1 class="content-title">{{ getTabLabel(activeTab) }}</h1>
        
        <!-- Filter Bar -->
        <div class="filter-bar">
          <div class="filter-group">
            <app-status-dropdown
              [options]="serviceTypeOptions"
              [selectedValue]="selectedServiceType"
              placeholder="Tất cả loại dịch vụ"
              (statusChange)="onServiceTypeChange($event)">
            </app-status-dropdown>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Đang tải dữ liệu...</p>
      </div>

      <!-- Services Table -->
      <div *ngIf="!isLoading" class="services-table-container">
        <table class="services-table" *ngIf="filteredServices.length > 0">
          <thead>
            <tr>
              <th>Dịch vụ</th>
              <th>Thời hạn</th>
              <th>Giá</th>
              <th>Trạng thái</th>
              <th *ngIf="activeTab === 'running'">Thao tác</th>
              <th *ngIf="activeTab === 'ended'">Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let service of paginatedServices; trackBy: trackByServiceId">
              <td class="service-cell">
                <div class="service-info">
                  <div class="service-name">{{ service.title }}</div>
                  <div class="service-description" *ngIf="service.description">
                    {{ service.description }}
                  </div>
                </div>
              </td>
              <td class="duration-cell">
                {{ getDurationText(service) }}
              </td>
              <td class="price-cell">
                {{ formatPrice(service.originalPrice) }}
              </td>
              <td class="status-cell">
                <span class="status-badge" [class.status-active]="service.isActive" [class.status-inactive]="!service.isActive">
                  {{ service.isActive ? 'Hoạt động' : 'Không hoạt động' }}
                </span>
              </td>
              
              <!-- Actions for running tab -->
              <td *ngIf="activeTab === 'running'" class="actions-cell">
                <div class="actions-menu-container">
                  <button 
                    class="actions-menu-btn"
                    (click)="toggleActionsMenu(service.id, $event)"
                    type="button">
                    <i class="fa fa-ellipsis-h"></i>
                  </button>
                  <div 
                    class="actions-menu"
                    [class.show]="showActionsMenu === service.id"
                    [attr.data-service-id]="service.id"
                    (click)="$event.stopPropagation()">
                    <div class="menu-item" (click)="onCancelSubscription(service, $event)">
                      <i class="fa fa-times menu-icon"></i>
                      <span>Hủy dịch vụ</span>
                    </div>
                    <div class="menu-item" (click)="onViewCampaignReport(service, $event)">
                      <i class="fa fa-file-alt menu-icon"></i>
                      <span>Báo cáo chiến dịch</span>
                    </div>
                  </div>
                </div>
              </td>
              
              <!-- Actions for ended tab -->
              <td *ngIf="activeTab === 'ended'" class="actions-cell">
                <div class="actions-menu-container">
                  <button 
                    class="actions-menu-btn"
                    (click)="toggleActionsMenu(service.id, $event)"
                    type="button">
                    <i class="fa fa-ellipsis-h"></i>
                  </button>
                  <div 
                    class="actions-menu"
                    [class.show]="showActionsMenu === service.id"
                    [attr.data-service-id]="service.id"
                    (click)="$event.stopPropagation()">
                    <div class="menu-item" (click)="onViewCampaignReport(service, $event)">
                      <i class="fa fa-file-alt menu-icon"></i>
                      <span>Báo cáo chiến dịch</span>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        
        <!-- Empty State -->
        <app-cv-empty-state 
          *ngIf="filteredServices.length === 0"
          [message]="'Không có dịch vụ nào'">
        </app-cv-empty-state>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="!isLoading && filteredServices.length > 0">
        <app-pagination
          [currentPage]="currentPage"
          [totalPages]="totalPages"
          (pageChange)="onPageChange($event)">
        </app-pagination>
      </div>
    </div>
  </div>

  <!-- Cancel Subscription Modal -->
  <app-generic-modal
    [show]="showCancelModal"
    [title]="'Hủy dịch vụ'"
    [maxWidth]="'500px'"
    [bodyBackground]="'white'"
    [closeOnOverlayClick]="true"
    (close)="onCloseCancelModal()">
    <div class="cancel-modal-content">
      <div *ngIf="selectedServiceForCancellation" class="cancel-info-section">
        <p class="modal-message">
          Bạn có chắc chắn muốn hủy dịch vụ <strong>{{ selectedServiceForCancellation.title }}</strong> không?
        </p>
        <p class="modal-warning">
          Hành động này không thể hoàn tác.
        </p>
        
        <div class="modal-actions">
          <button class="btn btn-secondary" (click)="onCloseCancelModal()">
            Hủy bỏ
          </button>
          <button class="btn btn-danger" (click)="onConfirmCancel()">
            Xác nhận hủy
          </button>
        </div>
      </div>
    </div>
  </app-generic-modal>
</div>