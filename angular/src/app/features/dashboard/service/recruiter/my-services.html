<div class="my-services-page" [class.sidebar-expanded]="sidebarExpanded">
  <!-- Toast Notification -->
  <app-toast-notification
    [show]="showToast"
    [message]="toastMessage"
    [type]="toastType"
    (close)="onToastClose()">
  </app-toast-notification>

  <!-- Breadcrumb Box -->
  <div class="breadcrumb-box" [class.sidebar-expanded]="sidebarExpanded">
    <div class="breadcrumb-container">
      <h1 class="page-title">Dịch vụ của tôi</h1>
    </div>
  </div>

  <div class="my-services-container">
    <!-- Left Sidebar -->
    <div class="services-sidebar">
      <nav class="sidebar-nav">
        <ul class="sidebar-nav-list">
          <li class="sidebar-nav-item" [class.active]="activeTab === 'running'">
            <a (click)="onTabChange('running')" class="sidebar-link">
              <i [ngClass]="getTabIcon('running')"></i>
              <span>{{ getTabLabel('running') }}</span>
            </a>
          </li>
          <li class="sidebar-nav-item" [class.active]="activeTab === 'scheduled'">
            <a (click)="onTabChange('scheduled')" class="sidebar-link">
              <i [ngClass]="getTabIcon('scheduled')"></i>
              <span>{{ getTabLabel('scheduled') }}</span>
            </a>
          </li>
          <li class="sidebar-nav-item" [class.active]="activeTab === 'unused'">
            <a (click)="onTabChange('unused')" class="sidebar-link">
              <i [ngClass]="getTabIcon('unused')"></i>
              <span>{{ getTabLabel('unused') }}</span>
            </a>
          </li>
          <li class="sidebar-nav-item" [class.active]="activeTab === 'pending'">
            <a (click)="onTabChange('pending')" class="sidebar-link">
              <i [ngClass]="getTabIcon('pending')"></i>
              <span>{{ getTabLabel('pending') }}</span>
            </a>
          </li>
          <li class="sidebar-nav-item" [class.active]="activeTab === 'ended'">
            <a (click)="onTabChange('ended')" class="sidebar-link">
              <i [ngClass]="getTabIcon('ended')"></i>
              <span>{{ getTabLabel('ended') }}</span>
            </a>
          </li>
          <li class="sidebar-nav-item" [class.active]="activeTab === 'expired'">
            <a (click)="onTabChange('expired')" class="sidebar-link">
              <i [ngClass]="getTabIcon('expired')"></i>
              <span>{{ getTabLabel('expired') }}</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Content Wrapper -->
    <div class="main-content-wrapper">
      <!-- Header -->
      <div class="content-header">
        <h1 class="content-title">{{ getTabLabel(activeTab) }}</h1>
        
        <!-- Filter Bar -->
        <div class="filter-bar">
          <div class="filter-group">
            <app-status-dropdown
              [options]="serviceTypeOptions"
              [selectedValue]="selectedServiceType"
              placeholder="Tất cả loại dịch vụ"
              (statusChange)="onServiceTypeChange($event)">
            </app-status-dropdown>
          </div>
          
          <div class="filter-group">
            <app-status-dropdown
              [options]="orderIdOptions"
              [selectedValue]="selectedOrderId"
              placeholder="Mã đơn hàng"
              (statusChange)="onOrderIdChange($event)">
            </app-status-dropdown>
          </div>
        </div>
      </div>

      <!-- Services Table -->
      <div class="services-table-container">
        <table class="services-table">
          <thead>
            <tr>
              <th>Mã đơn hàng</th>
              <th>Dịch vụ</th>
              <th>Số lượng</th>
              <!-- Tab unused: Kích hoạt dịch vụ và Hạn kích hoạt -->
              <th *ngIf="activeTab === 'unused'">Kích hoạt dịch vụ</th>
              <th *ngIf="activeTab === 'unused'">Hạn kích hoạt</th>
              <!-- Tab expired: Kích hoạt dịch vụ và Hạn kích hoạt -->
              <th *ngIf="activeTab === 'expired'">Kích hoạt dịch vụ</th>
              <th *ngIf="activeTab === 'expired'">Hạn kích hoạt</th>
              <!-- Tab pending: Ngày bắt đầu, Chiến dịch, và cột trống -->
              <th *ngIf="activeTab === 'pending'">Ngày bắt đầu</th>
              <th *ngIf="activeTab === 'pending'">Chiến dịch</th>
              <th *ngIf="activeTab === 'pending'"></th>
              <!-- Tab ended: Bắt đầu, Kết thúc, Chiến dịch, và cột trống -->
              <th *ngIf="activeTab === 'ended'">Bắt đầu</th>
              <th *ngIf="activeTab === 'ended'">Kết thúc</th>
              <th *ngIf="activeTab === 'ended'">Chiến dịch</th>
              <th *ngIf="activeTab === 'ended'"></th>
              <!-- Các tab khác: Bắt đầu, Kết thúc, Chiến dịch, Thao tác -->
              <th *ngIf="activeTab !== 'unused' && activeTab !== 'pending' && activeTab !== 'ended' && activeTab !== 'expired'">Bắt đầu</th>
              <th *ngIf="activeTab !== 'unused' && activeTab !== 'pending' && activeTab !== 'ended' && activeTab !== 'expired'">Kết thúc</th>
              <th *ngIf="activeTab !== 'unused' && activeTab !== 'pending' && activeTab !== 'ended' && activeTab !== 'expired'">Chiến dịch</th>
              <th *ngIf="activeTab !== 'pending' && activeTab !== 'ended' && activeTab !== 'expired' && activeTab !== 'scheduled'">Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let service of paginatedServices; trackBy: trackByServiceId">
              <td class="order-id-cell">
                <a (click)="onOrderIdClick(service.orderId, $event)" class="order-id-link">
                  #{{ service.orderId }}
                </a>
              </td>
              <td class="service-cell">
                <div class="service-info">
                  <div class="service-name-row">
                    <span class="service-name">{{ service.serviceName }}</span>
                    <span class="service-duration">/ {{ service.duration }}</span>
                    <span *ngIf="service.isGift" class="gift-badge">Quà tặng</span>
                  </div>
                  <div class="service-details">
                    <span class="service-code">Mã dịch vụ: {{ service.serviceCode }}</span>
                    <span class="service-separator">•</span>
                    <span class="purchase-date">Ngày mua: {{ service.purchaseDate }}</span>
                  </div>
                </div>
              </td>
              <td class="quantity-cell">{{ service.quantity }}</td>
              
              <!-- Tab unused: Kích hoạt dịch vụ và Hạn kích hoạt -->
              <td *ngIf="activeTab === 'unused'" class="date-cell">{{ service.activationDate || '-' }}</td>
              <td *ngIf="activeTab === 'unused'" class="date-cell">{{ service.expirationDate || '-' }}</td>
              
              <!-- Tab expired: Kích hoạt dịch vụ và Hạn kích hoạt (màu đỏ) -->
              <td *ngIf="activeTab === 'expired'" class="date-cell">{{ service.activationDate || '-' }}</td>
              <td *ngIf="activeTab === 'expired'" class="date-cell expired-date">{{ service.expirationDate || '-' }}</td>
              
              <!-- Tab pending: Ngày bắt đầu, Chiến dịch, và menu 3 chấm -->
              <td *ngIf="activeTab === 'pending'" class="date-cell">{{ service.startDate }}</td>
              <td *ngIf="activeTab === 'pending'" class="campaign-cell">
                <div *ngIf="service.campaign !== '-'" class="campaign-info">
                  <span class="campaign-name">{{ service.campaign }}</span>
                  <span *ngIf="service.campaignJob" class="campaign-job" [innerHTML]="service.campaignJob"></span>
                </div>
                <span *ngIf="service.campaign === '-'" class="campaign-empty">-</span>
              </td>
              <td *ngIf="activeTab === 'pending'" class="actions-cell">
                <div class="actions-menu-container">
                  <button 
                    class="actions-menu-btn"
                    (click)="toggleActionsMenu(service.id, $event)"
                    type="button">
                    <i class="fa fa-ellipsis-h"></i>
                  </button>
                  <div 
                    class="actions-menu"
                    [class.show]="showActionsMenu === service.id"
                    [attr.data-service-id]="service.id"
                    (click)="$event.stopPropagation()">
                    <div class="menu-item" (click)="onCancelActivation(service, $event)">
                      <i class="fa fa-times menu-icon"></i>
                      <span>Hủy kích hoạt dịch vụ</span>
                    </div>
                  </div>
                </div>
              </td>
              
              <!-- Tab ended: Bắt đầu, Kết thúc, Chiến dịch, và menu 3 chấm -->
              <td *ngIf="activeTab === 'ended'" class="date-cell">{{ service.startDate }}</td>
              <td *ngIf="activeTab === 'ended'" class="date-cell">{{ service.endDate }}</td>
              <td *ngIf="activeTab === 'ended'" class="campaign-cell">
                <div *ngIf="service.campaign !== '-'" class="campaign-info">
                  <span class="campaign-name">{{ service.campaign }}</span>
                  <span *ngIf="service.campaignJob" class="campaign-job" [innerHTML]="service.campaignJob"></span>
                </div>
                <span *ngIf="service.campaign === '-'" class="campaign-empty">-</span>
              </td>
              <td *ngIf="activeTab === 'ended'" class="actions-cell">
                <div class="actions-menu-container">
                  <button 
                    class="actions-menu-btn"
                    (click)="toggleActionsMenu(service.id, $event)"
                    type="button">
                    <i class="fa fa-ellipsis-h"></i>
                  </button>
                  <div 
                    class="actions-menu"
                    [class.show]="showActionsMenu === service.id"
                    [attr.data-service-id]="service.id"
                    (click)="$event.stopPropagation()">
                    <div class="menu-item" (click)="onViewCampaignReport(service, $event)">
                      <i class="fa fa-file-alt menu-icon"></i>
                      <span>Báo cáo chiến dịch tuyển dụng</span>
                    </div>
                  </div>
                </div>
              </td>
              
              <!-- Các tab khác: Bắt đầu, Kết thúc, Chiến dịch -->
              <td *ngIf="activeTab !== 'unused' && activeTab !== 'pending' && activeTab !== 'ended' && activeTab !== 'expired'" class="date-cell">{{ service.startDate }}</td>
              <td *ngIf="activeTab !== 'unused' && activeTab !== 'pending' && activeTab !== 'ended' && activeTab !== 'expired'" class="date-cell">{{ service.endDate }}</td>
              <td *ngIf="activeTab !== 'unused' && activeTab !== 'pending' && activeTab !== 'ended' && activeTab !== 'expired'" class="campaign-cell">
                <div *ngIf="service.campaign !== '-'" class="campaign-info">
                  <span class="campaign-name">{{ service.campaign }}</span>
                  <span *ngIf="service.campaignJob" class="campaign-job" [innerHTML]="service.campaignJob"></span>
                </div>
                <span *ngIf="service.campaign === '-'" class="campaign-empty">-</span>
              </td>
              
              <!-- Thao tác cho các tab khác -->
              <td *ngIf="activeTab !== 'pending' && activeTab !== 'ended' && activeTab !== 'expired' && activeTab !== 'scheduled'" class="actions-cell">
                <div class="actions-container">
                  <!-- Kích hoạt dịch vụ - cho tab unused -->
                  <span 
                    *ngIf="activeTab === 'unused'" 
                    class="activate-tag"
                    (click)="onActivateService(service, $event)"
                    title="Kích hoạt dịch vụ">
                    Kích hoạt
                  </span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        
        <!-- Empty State -->
        <app-cv-empty-state 
          *ngIf="filteredServices.length === 0"
          [message]="'Không có dịch vụ nào'">
        </app-cv-empty-state>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="filteredServices.length > 0">
        <app-pagination
          [currentPage]="currentPage"
          [totalPages]="totalPages"
          (pageChange)="onPageChange($event)">
        </app-pagination>
      </div>
    </div>
  </div>

  <!-- Activate Service Modal -->
  <app-generic-modal
    [show]="showActivateModal"
    [title]="'Yêu cầu kích hoạt dịch vụ'"
    [maxWidth]="'600px'"
    [bodyBackground]="'white'"
    [closeOnOverlayClick]="true"
    (close)="onCloseActivateModal()">
    <div class="activate-service-modal-content">
      <div *ngIf="selectedServiceForActivation" class="service-info-section">
        <div class="service-details">
          <div class="detail-row">
            <span class="detail-label">Mã đơn hàng:</span>
            <span class="detail-value">{{ selectedServiceForActivation.orderId }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Dịch vụ:</span>
            <span class="detail-value">{{ selectedServiceForActivation.serviceName }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Số lượng:</span>
            <div class="quantity-input-wrapper">
              <input 
                type="number" 
                class="quantity-input" 
                [(ngModel)]="selectedQuantity"
                [min]="1"
                [max]="selectedServiceForActivation.quantity"
                (keydown)="$event.stopPropagation()"
                (click)="$event.stopPropagation()">
              <span class="quantity-max">/{{ selectedServiceForActivation.quantity }}</span>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-secondary" (click)="onCloseActivateModal()">
            Hủy
          </button>
          <button class="btn btn-primary" (click)="onConfirmActivate()">
            Đồng ý
          </button>
        </div>
      </div>
    </div>
  </app-generic-modal>

  <!-- Cancel Activation Modal -->
  <app-generic-modal
    [show]="showCancelActivationModal"
    [title]="'Hủy kích hoạt dịch vụ'"
    [maxWidth]="'500px'"
    [bodyBackground]="'white'"
    [closeOnOverlayClick]="true"
    (close)="onCloseCancelActivationModal()">
    <div class="cancel-activation-modal-content">
      <div *ngIf="selectedServiceForCancellation" class="cancel-activation-info-section">
        <p class="modal-message">
          Bạn có chắc chắn muốn hủy kích hoạt dịch vụ này không? Trạng thái dịch vụ sẽ được chuyển về Chưa sử dụng.
        </p>
        
        <div class="modal-actions">
          <button class="btn btn-secondary" (click)="onCloseCancelActivationModal()">
            Hủy
          </button>
          <button class="btn btn-primary" (click)="onConfirmCancelActivation()">
            Đồng ý
          </button>
        </div>
      </div>
    </div>
  </app-generic-modal>
</div>

