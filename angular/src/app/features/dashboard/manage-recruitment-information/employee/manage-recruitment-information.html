<div
  class="employee-job-management-page"
  [style.margin-left]="getPageMarginLeft()"
  [style.width]="getPageWidth()"
>
  <div
    class="breadcrumb-box"
    [style.left]="getBreadcrumbLeft()"
    [style.width]="getBreadcrumbWidth()"
  >
    <div class="breadcrumb-container">
      <h1 class="page-title">Quản lý tin tuyển dụng</h1>
    </div>
  </div>

  <div class="job-management-content" [style.max-width]="getContentMaxWidth()">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card" *ngFor="let card of summaryCards">
        <div class="summary-card-icon" [style.border-color]="card.borderColor">
          <i [class]="card.icon"></i>
        </div>
        <div class="summary-card-content">
          <div class="summary-card-value">{{ card.value }}</div>
          <div class="summary-card-label">{{ card.label }}</div>
        </div>
      </div>
    </div>

    <!-- Job List Card -->
    <div class="job-list-card">
      <div class="wrapper-content" [class.show-detail-job]="selectedJob">
        <div class="job-list-column">
          <!-- Filter Bar with 3 Dropdowns -->
          <div class="filter-bar">
            <div class="filter-header">
              <i class="fa fa-filter filter-icon"></i>
              <span class="filter-title">Bộ lọc</span>
            </div>
            <div class="filter-controls">
              <!-- Priority Level Filter -->
              <div class="filter-group filter-dropdown-wrapper" (click)="$event.stopPropagation()">
                <label class="filter-label">
                  <i class="fa fa-star"></i>
                  Mức độ ưu tiên
                </label>
                <button type="button" class="filter-dropdown" (click)="togglePriorityDropdown()">
                  <span class="filter-value">{{ selectedPriorityLevel.label }}</span>
                  <i class="fa fa-chevron-down dropdown-icon" [class.rotate]="showPriorityDropdown"></i>
                </button>
                <div class="filter-dropdown-menu" *ngIf="showPriorityDropdown">
                  <button
                    type="button"
                    class="filter-dropdown-item"
                    *ngFor="let option of priorityLevelOptions"
                    [class.active]="selectedPriorityLevel.value === option.value"
                    (click)="selectPriorityLevel(option)"
                  >
                    <span>{{ option.label }}</span>
                    <i class="fa fa-check check-icon"></i>
                  </button>
                </div>
              </div>

              <!-- Recruiter Level Filter -->
              <div class="filter-group filter-dropdown-wrapper" (click)="$event.stopPropagation()">
                <label class="filter-label">
                  <i class="fa fa-shield-alt"></i>
                  Cấp độ tuyển dụng
                </label>
                <button type="button" class="filter-dropdown" (click)="toggleRecruiterDropdown()">
                  <span class="filter-value">{{ selectedRecruiterLevel.label }}</span>
                  <i class="fa fa-chevron-down dropdown-icon" [class.rotate]="showRecruiterDropdown"></i>
                </button>
                <div class="filter-dropdown-menu" *ngIf="showRecruiterDropdown">
                  <button
                    type="button"
                    class="filter-dropdown-item"
                    *ngFor="let option of recruiterLevelOptions"
                    [class.active]="selectedRecruiterLevel.value === option.value"
                    (click)="selectRecruiterLevel(option)"
                  >
                    <span>{{ option.label }}</span>
                    <i class="fa fa-check check-icon"></i>
                  </button>
                </div>
              </div>

              <!-- Risk Job Level Filter -->
              <div class="filter-group filter-dropdown-wrapper" (click)="$event.stopPropagation()">
                <label class="filter-label">
                  <i class="fa fa-exclamation-triangle"></i>
                  Mức độ rủi ro
                </label>
                <button type="button" class="filter-dropdown" (click)="toggleRiskJobDropdown()">
                  <span class="filter-value">{{ selectedRiskJobLevel.label }}</span>
                  <i class="fa fa-chevron-down dropdown-icon" [class.rotate]="showRiskJobDropdown"></i>
                </button>
                <div class="filter-dropdown-menu" *ngIf="showRiskJobDropdown">
                  <button
                    type="button"
                    class="filter-dropdown-item"
                    *ngFor="let option of riskJobLevelOptions"
                    [class.active]="selectedRiskJobLevel.value === option.value"
                    (click)="selectRiskJobLevel(option)"
                  >
                    <span>{{ option.label }}</span>
                    <i class="fa fa-check check-icon"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div class="loading-state" *ngIf="isLoading">
            <div class="loading-spinner">
              <i class="fa fa-spinner fa-spin"></i>
            </div>
            <p class="loading-text">Đang tải dữ liệu...</p>
          </div>

          <!-- Job List -->
          <div class="job-list" *ngIf="!isLoading && filteredPostings.length > 0; else emptyState">
            <div
              class="job-item"
              *ngFor="let posting of filteredPostings"
              [class.selected]="selectedJob?.id === posting.id"
              (click)="onJobItemClick(posting)"
              (mouseenter)="onJobItemMouseEnter(posting.id)"
              (mouseleave)="onJobItemMouseLeave()"
            >
              <div class="job-item-left">
                <div class="company-logo">
                  <img
                    [src]="getCompanyLogoUrl(posting)"
                    [alt]="posting.companyName"
                    onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjRjNGNEY2Ii8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE4IiBmb250LXdlaWdodD0iNzAwIiBmaWxsPSIjNkI3MjgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+PC90ZXh0Pgo8L3N2Zz4='; this.onerror=null;"
                  />
                </div>
              </div>

              <div class="job-item-center">
                <div class="job-header-top">
                  <div class="campaign-code">Mã: #{{ posting.id }}</div>
                  <div class="job-salary">
                    <i class="fa fa-dollar-sign"></i>
                    <span>{{ getSalaryRangeText(posting) }}</span>
                  </div>
                </div>
                <div class="job-header">
                  <h3 class="job-title">{{ posting.title }}</h3>
                </div>

                <div class="company-name-wrapper">
                  <div class="company-name">{{ posting.companyName }}</div>
                  <button
                    type="button"
                    class="view-detail-btn"
                    (click)="viewDetail(posting); $event.stopPropagation()"
                  >
                    Xem chi tiết
                  </button>
                </div>

                <div class="job-tags-wrapper">
                  <div class="job-tags">
                    <span class="tag tag-location">{{ getLocationText(posting) }}</span>
                    <!-- <span class="tag tag-experience">{{ getExperienceText(posting) }}</span> -->
                    <span
                      class="reject-reason-tag"
                      *ngIf="posting.status === 5 && posting.rejectedReason && hoveredJobId === posting.id"
                      (click)="onViewRejectReason(posting); $event.stopPropagation()"
                    >
                      <i class="fa fa-info-circle"></i>
                      Lý do từ chối
                    </span>
                  </div>
                  <div class="job-status">
                    <span [class]="getStatusBadgeClass(posting.status)">
                      {{ getStatusLabel(posting.status) }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #emptyState>
            <div class="empty-list" *ngIf="!isLoading">
              <i class="fa fa-clipboard-list"></i>
              <p>Không có tin tuyển dụng nào phù hợp.</p>
            </div>
          </ng-template>

          <app-pagination
            *ngIf="!isLoading && totalPages > 1"
            [currentPage]="currentPage"
            [totalPages]="totalPages"
            [totalItems]="totalItems"
            [itemsPerPage]="itemsPerPage"
            (pageChange)="onPageChange($event)"
          >
          </app-pagination>
        </div>

        <!-- Job Detail View -->
        <div class="box-view-job-detail" *ngIf="selectedJob">
          <div class="job-detail-header">
            <div class="campaign-code-header">Mã tin: #{{ selectedJob.id }}</div>
            <h2 class="job-detail-title">{{ selectedJob.title }}</h2>
            <div class="job-tags-header">
              <span class="job-tag">{{ selectedJob.categoryName }}</span>
              <span class="job-tag">{{ getSalaryRangeText(selectedJob) }}</span>
            </div>
            <button type="button" class="close-detail-btn" (click)="onCloseDetail()">
              <i class="fa fa-times"></i>
            </button>
          </div>

          <div class="job-detail-content">
            <div class="detail-section" *ngIf="selectedJob.description">
              <h3 class="section-title">Mô tả công việc</h3>
              <div class="section-content" [innerHTML]="selectedJob.description"></div>
            </div>

            <div class="detail-section" *ngIf="selectedJob.requirements">
              <h3 class="section-title">Yêu cầu ứng viên</h3>
              <div class="section-content" [innerHTML]="selectedJob.requirements"></div>
            </div>

            <div class="detail-section" *ngIf="selectedJob.benefits">
              <h3 class="section-title">Quyền lợi</h3>
              <div class="section-content" [innerHTML]="selectedJob.benefits"></div>
            </div>

            <div class="detail-section" *ngIf="selectedJob.workLocation">
              <h3 class="section-title">Địa điểm làm việc</h3>
              <p class="section-content">{{ selectedJob.workLocation }}</p>
            </div>

            <div class="detail-section">
              <h3 class="section-title">Thông tin khác</h3>
              <ul class="section-list">
                <li><strong>Số lượng tuyển:</strong> {{ selectedJob.quantity }} người</li>
                <li *ngIf="selectedJob.workTime"><strong>Thời gian làm việc:</strong> {{ selectedJob.workTime }}</li>
                <li *ngIf="selectedJob.postedAt"><strong>Ngày đăng:</strong> {{ selectedJob.postedAt | date: 'dd/MM/yyyy' }}</li>
                <li *ngIf="selectedJob.expiresAt"><strong>Hạn nộp:</strong> {{ selectedJob.expiresAt | date: 'dd/MM/yyyy' }}</li>
              </ul>
            </div>

            <div class="detail-actions">
              <button type="button" class="action-btn approve-btn" (click)="onApprove()">
                Duyệt
              </button>
              <button type="button" class="action-btn reject-btn" (click)="onReject()">
                Từ chối
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- View/Edit Reject Reason Modal -->
  <div
    class="reject-modal-overlay"
    *ngIf="showViewRejectReasonModal"
    (click)="onCloseViewRejectReasonModal()"
    [style.padding-left]="getModalPaddingLeft()"
  >
    <div
      class="reject-modal-content"
      (click)="$event.stopPropagation()"
      [style.max-width]="getModalMaxWidth()"
    >
      <div class="reject-modal-header">
        <h3 class="reject-modal-title">Lý do từ chối</h3>
        <button type="button" class="close-modal-btn" (click)="onCloseViewRejectReasonModal()">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div class="reject-modal-body">
        <div class="form-group">
          <label class="form-label">Lý do từ chối <span class="required">*</span></label>
          <textarea
            class="form-textarea"
            [(ngModel)]="rejectReason"
            [readonly]="!editingRejectReason"
            [class.readonly]="!editingRejectReason"
            placeholder="Nhập lý do từ chối tin tuyển dụng này..."
            rows="5"
          ></textarea>
        </div>
      </div>
      <div class="reject-modal-footer">
        <button type="button" class="btn btn-cancel" (click)="onCloseViewRejectReasonModal()">
          Đóng
        </button>
        <button
          type="button"
          class="btn btn-edit"
          *ngIf="!editingRejectReason"
          (click)="onEditRejectReason()"
        >
          Sửa
        </button>
        <button
          type="button"
          class="btn btn-save"
          *ngIf="editingRejectReason"
          (click)="onSaveRejectReason()"
          [disabled]="!rejectReason.trim()"
        >
          Lưu
        </button>
        <button
          type="button"
          class="btn btn-cancel"
          *ngIf="editingRejectReason"
          (click)="onCancelEditRejectReason()"
        >
          Hủy
        </button>
      </div>
    </div>
  </div>

  <!-- Reject Modal -->
  <div
    class="reject-modal-overlay"
    *ngIf="showRejectModal"
    (click)="onCloseRejectModal()"
    [style.padding-left]="getModalPaddingLeft()"
  >
    <div
      class="reject-modal-content"
      (click)="$event.stopPropagation()"
      [style.max-width]="getModalMaxWidth()"
    >
      <div class="reject-modal-header">
        <h3 class="reject-modal-title">Từ chối tin tuyển dụng</h3>
        <button type="button" class="close-modal-btn" (click)="onCloseRejectModal()">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div class="reject-modal-body">
        <div class="form-group">
          <label class="form-label">Lý do từ chối <span class="required">*</span></label>
          <textarea
            class="form-textarea"
            [(ngModel)]="rejectReason"
            placeholder="Nhập lý do từ chối tin tuyển dụng này..."
            rows="5"
          ></textarea>
        </div>
      </div>
      <div class="reject-modal-footer">
        <button type="button" class="btn btn-cancel" (click)="onCloseRejectModal()">Hủy</button>
        <button
          type="button"
          class="btn btn-submit"
          (click)="onSubmitReject()"
          [disabled]="!rejectReason.trim()"
        >
          Xác nhận từ chối
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <app-toast-notification
    [show]="showToast"
    [message]="toastMessage"
    [type]="toastType"
    (close)="onToastClose()"
  >
  </app-toast-notification>
</div>