<div class="cv-management-container">
  <!-- Header Section -->
  <div class="cv-header">
    <div class="header-content">
      <h1 class="page-title">{{ translate('cv_management.title') }}</h1>
      <p class="page-subtitle">{{ translate('cv_management.subtitle') }}</p>
    </div>
  </div>

      <!-- Main Content -->
      <div class="cv-main-content" [class.has-priority-cv]="defaultCv" [class.no-priority-cv]="!defaultCv">
        <!-- Left Column - Priority CV (Default CV) -->
        <div class="cv-priority-column" *ngIf="defaultCv">
          <div class="priority-cv-card">
            <div class="priority-cv-header">
              <h3 class="priority-cv-title">
                <i class="fa fa-star"></i>
                CV Ưu tiên
              </h3>
            </div>
            <div class="priority-cv-content" (click)="viewCv(defaultCv.id)">
              <div class="priority-cv-preview">
                <img 
                  [src]="defaultCv.template?.previewImageUrl || 'assets/images/cv-management/cv-placeholder.png'" 
                  [alt]="defaultCv.cvName || 'CV Preview'"
                  class="priority-cv-image">
              </div>
              <div class="priority-cv-info">
                <h4 class="priority-cv-name">{{ defaultCv.cvName || 'Untitled CV' }}</h4>
                <p class="priority-cv-version">Version: {{ defaultCv.template?.version || '1.0' }}</p>
                <p class="priority-cv-date">Cập nhật: {{ formatDate(defaultCv.publishedAt || defaultCv.creationTime) }}</p>
              </div>
              <div class="priority-cv-actions">
                <button class="btn-priority-view" (click)="viewCv(defaultCv.id); $event.stopPropagation()">
                  <i class="fa fa-eye"></i>
                  Xem CV
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Center Column - CV List and Upload Section -->
        <div class="cv-left-column" [class.full-width]="!defaultCv">
          <!-- CV List -->
          <app-cv-list
            [cvs]="cvs"
            [loading]="loading"
            (cvViewed)="viewCv($event)"
            (cvEdited)="editCv($event)"
            (cvDuplicated)="onCvDuplicated($event)"
            (cvSetDefault)="onSetDefault($event)"
            (cvDeleted)="onCvDeleted($event)"
            (cvUpdated)="onCvUpdated($event)"
            (createCv)="onCreateCv()">
          </app-cv-list>

          <!-- Upload CV Section -->
          <div class="upload-cv-section">
            <div class="upload-cv-header">
              <h2 class="upload-cv-title">{{ translate('cv_management.upload_cv_title') }}</h2>
              <button 
                type="button"
                class="btn btn-primary"
                (click)="onOpenUploadCvModal()">
                <i class="fa fa-upload"></i>
                {{ translate('cv_management.upload_cv') }}
              </button>
            </div>
            
            <!-- Empty State for Upload -->
            <div class="upload-empty-state" *ngIf="uploadedCvs.length === 0">
              <div class="upload-empty-icon">
                <img src="assets/images/cv-management/no-cv.png" alt="No CV" class="upload-no-cv-image">
              </div>
              <p class="upload-empty-message">{{ translate('cv_management.no_cv_uploaded') }}</p>
            </div>

            <!-- Uploaded CVs -->
            <div class="uploaded-cvs-grid" *ngIf="uploadedCvs.length > 0">
              <div class="uploaded-cv-item" *ngFor="let cv of uploadedCvs; trackBy: trackByCvName">
                <app-uploaded-cv-card
                  [isStarred]="cv.isStarred"
                  (view)="onCvView(cv)"
                  (download)="onCvDownload(cv)"
                  (toggleStar)="onCvToggleStar(cv)"
                  (copyLink)="onCvCopyLink()"
                  (shareFacebook)="onCvShareFacebook()"
                  (rename)="onCvRename(cv)"
                  (delete)="onCvDelete(cv)">
                </app-uploaded-cv-card>
                
                <!-- CV Info outside the card -->
                <div class="cv-info">
                  <h3 class="cv-name">{{ cv.name }}</h3>
                  <p class="cv-date">{{ translate('cv_card.updated') }} {{ cv.uploadDate }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column - Profile Sidebar Section -->
        <div class="profile-sidebar-section" [class.full-width]="!defaultCv">
          <!-- Profile Card -->
          <div class="profile-card">
            <div class="profile-layout">
              <!-- Left Column - Profile Icon -->
              <div class="profile-left-column">
                <div class="profile-icon" (click)="openProfilePictureModal()">
                  <i class="fa fa-user-circle"></i>
                </div>
              </div>
              
              <!-- Right Column - Profile Info -->
              <div class="profile-right-column">
                <div class="profile-info">
                  <span class="profile-label">Profile</span>
                  <h3>Chào bạn trở lại, {{ profileData.fullName || 'User' }}</h3>
                </div>
                
                <div class="account-status">
                  <span class="verified-badge">Tài khoản đã xác thực</span>
                </div>
              </div>
            </div>

            <!-- Toggle Settings Section -->
            <div class="toggle-settings-section">
              <!-- Toggle 1: Job Search Status -->
              <div class="toggle-setting-item">
                <div class="toggle-wrapper">
                  <label class="toggle-label">
                    <input 
                      type="checkbox" 
                      class="toggle-input" 
                      [ngModel]="jobSearchEnabled"
                      (change)="onJobSearchToggle($event)"
                      [checked]="jobSearchEnabled">
                    <span class="toggle-slider" [class.active]="jobSearchEnabled"></span>
                  </label>
                  <div class="toggle-content">
                    <span class="toggle-text" [class.inactive]="!jobSearchEnabled">
                      {{ jobSearchEnabled ? 'Đang bật tìm việc' : 'Đang Tắt tìm việc' }}
                    </span>
                    <p class="toggle-description">
                      Bật tìm việc giúp hồ sơ của bạn nổi bật hơn và được chú ý nhiều hơn trong danh sách tìm kiếm của NTD.
                    </p>
                  </div>
                </div>
              </div>

              <!-- Toggle 2: Allow Recruiter Search -->
              <div class="toggle-setting-item">
                <div class="toggle-wrapper">
                  <label class="toggle-label">
                    <input 
                      type="checkbox" 
                      class="toggle-input" 
                      [ngModel]="allowRecruiterSearch"
                      (change)="onAllowRecruiterSearchToggle($event)"
                      [checked]="allowRecruiterSearch">
                    <span class="toggle-slider" [class.active]="allowRecruiterSearch"></span>
                  </label>
                  <div class="toggle-content">
                    <span class="toggle-text">
                      Cho phép NTD tìm kiếm hồ sơ
                    </span>
                    <div class="toggle-description-container">
                      <p class="toggle-description">
                        Khi có cơ hội việc làm phù hợp, NTD sẽ liên hệ và trao đổi với bạn qua
                      </p>
                      
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Toast Notification -->
      <app-toast-notification
        [show]="showToast"
        [message]="toastMessage"
        [type]="toastType"
        (close)="onToastClose()">
      </app-toast-notification>

      <!-- Profile Picture Edit Modal -->
      <app-profile-picture-edit-modal
        *ngIf="showProfilePictureModal"
        (close)="closeProfilePictureModal()"
        (changePicture)="onProfilePictureChange()"
        (deletePicture)="onProfilePictureDelete()">
      </app-profile-picture-edit-modal>

  <!-- Upload CV Modal -->
  <app-upload-cv-modal 
    *ngIf="showUploadCvModal"
    (close)="onCloseUploadCvModal()"
    (uploadCv)="onUploadCv($event)">
  </app-upload-cv-modal>

  <!-- Download CV Modal -->
  <app-download-cv-modal
    *ngIf="showDownloadModal"
    (close)="onCloseDownloadModal()"
    (downloadWithoutLogo)="onDownloadWithoutLogo()"
    (downloadFree)="onDownloadFree()">
  </app-download-cv-modal>

  <!-- Rename CV Modal -->
  <app-rename-cv-modal
    *ngIf="showRenameModal && cvToRename"
    [currentName]="cvToRename.name"
    (close)="onCloseRenameModal()"
    (rename)="onRename($event)">
  </app-rename-cv-modal>
</div>

