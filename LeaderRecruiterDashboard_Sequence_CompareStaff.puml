@startuml
title Compare Staff Performance - Sequence Diagram

autonumber 1

actor "Leader Recruiter" as Leader
participant "RecruitmentDashboardController" as API
participant "RecruitmentDashboardAppService" as Service
participant "RecruiterRepository" as RecruiterRepo
participant "ActivityLogRepository" as ActivityRepo
database "Database" as DB

Leader -> API : POST /compare
activate API
note over Leader, API
CompareStaffRequest:
- StaffIds: [Guid[]]
- Filter: DashboardFilterDto
end note

API -> Service : CompareStaffPerformanceAsync(staffIds, filter)
activate Service

autonumber 1.1
Service -> RecruiterRepo : GetCurrentRecruiterProfileAsync()
activate RecruiterRepo

autonumber 1.1.1
RecruiterRepo -> DB : ExecuteQuery()
activate DB
return Return result

autonumber 1.1.2
return Return currentRecruiterProfile

autonumber 1.2
Service -> Service : Validate IsLead()

alt Not a Leader
    autonumber 1.2.1
    return Return error message
    autonumber 1.2.2
    return Return 403 Forbidden
else Is Leader
    autonumber 1.3
    Service -> Service : Initialize result list
    
    loop For each staffId
        autonumber 1.4
        Service -> RecruiterRepo : FindAsync(staffId)
        activate RecruiterRepo
        
        autonumber 1.4.1
        RecruiterRepo -> DB : ExecuteQuery()
        activate DB
        return Return result
        
        autonumber 1.4.2
        return Return staffProfile
        
        autonumber 1.5
        Service -> Service : Validate same company
        
        alt Invalid or Different Company
            autonumber 1.5.1
            Service -> Service : Skip this staff
        else Valid Staff
            autonumber 1.6
            Service -> ActivityRepo : Get staff activities
            activate ActivityRepo
            
            autonumber 1.6.1
            ActivityRepo -> DB : ExecuteQuery()
            activate DB
            return Return result
            
            autonumber 1.6.2
            return Return activityLogs
            
            autonumber 1.7
            Service -> Service : Calculate performance
            
            autonumber 1.8
            Service -> Service : Add to result list
        end
    end
    
    autonumber 1.9
    Service -> Service : Build response array
    
    autonumber 1.10
    return Return staff performances
    
    autonumber 1.11
    return Return 200 OK + JSON
end

@enduml





